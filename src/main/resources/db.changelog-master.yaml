databaseChangeLog:
  -  preConditions:
  -  runningAs:
       username: root

  - changeSet:
      id: create-base-table-card
      author: amyers
#      preConditions:
#        - onFail: MARK_RAN
#          not:
#            tableExists:
#              tableName: CARD
      changes:
        - createTable:
            tableName: CARD
            columns:
              - column:
                  name: CARD_ID
                  type: int
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: NAME
                  type: varchar(512)
              - column:
                  name: COLOR_IDENTITY
                  type: varchar(32)
              - column:
                  name: MANA_COST
                  type: varchar(32)
              - column:
                  name: CMC
                  type: varchar(16)
        - createIndex:
            clustered: true
            columns:
              - column:
                  descending: true
                  name: NAME
            indexName: idx_card_name
            tableName: CARD
            unique: true
        - createTable:
            tableName: ENTITY_ATTRIBUTE_CODE
            columns:
              - column:
                  name: CODE_ID
                  type: int
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: CODE
                  type: varchar(512)
                  constraints:
                    unique: true
                    nullable: false
        - createIndex:
            indexName: IDX_ENTITY_ATTRIBUTE_CODE_ID
            tableName: ENTITY_ATTRIBUTE_CODE
            unique: true
            columns:
              - column:
                  descending: true
                  name: CODE_ID
        - createTable:
            tableName: ENTITY_ATTRIBUTE_VALUE
            columns:
              - column:
                  name: VALUE_ID
                  type: int
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: VALUE
                  type: varchar(1024)
                  constraints:
                    - nullable: false
              - column:
                  name: CODE_ID
                  type: int
                  constraints:
                    foreignKeyName: FK_ENTITY_ATTRIBUTE_VALUE_TO_CODE
                    references: ENTITY_ATTRIBUTE_CODE(CODE_ID)
                    nullable: false
        - createIndex:
            indexName: IDX_ENTITY_ATTRIBUTE_VALUE_ID
            tableName: ENTITY_ATTRIBUTE_VALUE
            unique: true
            columns:
              - column:
                  descending: true
                  name: VALUE_ID
        - createTable:
            tableName: CARD_ENTITY_ATTRIBUTES
            columns:
              - column:
                  name: CARD_ID
                  type: int
                  constraints:
                    foreignKeyName: fk_card_entity_attribute_to_card_id
                    references: CARD(CARD_ID)
                    nullable: false
              - column:
                  name: CODE_ID
                  type: int
                  constraints:
                    foreignKeyName: fk_card_entity_attribute_to_code_id
                    references: ENTITY_ATTRIBUTE_CODE(CODE_ID)
                    nullable: false
              - column:
                  name: ATTRIBUTE_ID
                  type: int
#        - addForeignKeyConstraint:
#            constraintName: FK_CARD_ENTITY_ATTRIBUTE
#            baseTableName: CARD,ENTITY_ATTRIBUTE_CODE
#            baseColumnNames: CARD_ID,ENTITY_ATTRIBUTE_CODE
#            referencedTableName: CARD,ENTITY_ATTRIBUTE_CODE_ID
#            referencedColumnNames: CARD_ID,ENTITY_ATTRIBUTE_CODE_ID

  - changeSet:
      id: create-table-formats
      author: amyers
      preConditions:
        - onFail: MARK_RAN
          not:
            tableExists:
              tableName: FORMATS
      changes:
        - createTable:
            tableName: FORMATS
            columns:
              - column:
                  name: ID
                  type: int
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: NAME
                  type: varchar(512)
  - changeSet:
      id: create-table-banlist
      author: amyers
      preConditions:
        - onFail: MARK_RAN
          not:
            tableExists:
              tableName: BANLIST
      changes:
        - createTable:
            tableName: BANLIST
            columns:
              - column:
                  name: ID
                  type: int
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: CARD_NAME
                  type: varchar(512)
                  constraints:
                    foreignKeyName: fk_banlist_to_card_name
                    references: CARD(name)
                    nullable: false
        - insert:
            columns:
              - column:
                  name: code
                  value: 'supertype'
            dbms: '!h2,  mysql'
            schemaName: mtg
            tableName: ENTITY_ATTRIBUTE_CODE

